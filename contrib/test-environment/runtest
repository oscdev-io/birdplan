#!/bin/bash

pacman -Q bird
pacman -Q exabgp

cd /root/birdplan || :
echo "Excuting in '$(pwd)'..."

ARGS=("$@")
if [ ${#ARGS[@]} -eq 0 ]; then
    cpus=$(nproc)
    jobcount=$((cpus / 2))
    ARGS=(--numprocesses="$jobcount" --dist=loadfile)
fi

# echo "RUNNING: tox -- ${ARGS[*]}"
# nice -n 20 tox -- "${ARGS[@]}"
# nice -n 20 tox -e cov-html

python -m birdplan --version

nice -n 20 pytest --cov=birdplan "${ARGS[@]}"
